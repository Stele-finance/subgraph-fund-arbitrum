type Deposit @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  token: Bytes! # address
  symbol: String!
  amount: BigDecimal! # formatted amount (not raw)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type DepositFee @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  manager: Bytes! # address
  token: Bytes! # address
  symbol: String!
  amount: BigDecimal! # formatted amount (not raw)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Swap @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  tokenIn: Bytes! # address
  tokenOut: Bytes! # address
  tokenInSymbol: String!
  tokenOutSymbol: String!
  tokenInAmount: BigDecimal! # formatted amount (not raw)
  tokenOutAmount: BigDecimal! # formatted amount (not raw)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Withdraw @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  percentage: BigDecimal! # withdrawal percentage
  amountUSD: BigDecimal! # USD value of the withdrawal
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type WithdrawFee @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  manager: Bytes! # address
  token: Bytes! # address
  symbol: String!
  amount: BigDecimal! # formatted amount (not raw)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Create @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  manager: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InfoCreated @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type OwnerChanged @entity(immutable: true) {
  id: Bytes!
  oldOwner: Bytes! # address
  newOwner: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Join @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type FundShare @entity(immutable: false) {
  id: String! # fundId
  fundId: BigInt! # uint256
  totalShare: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InvestorShare @entity(immutable: false) {
  id: String! # fundId-investor
  fundId: BigInt! # uint256
  investor: Bytes! # address
  share: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type SettingCreated @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ManagerFeeChanged @entity(immutable: true) {
  id: Bytes!
  managerFee: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type AddToken @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type RemoveToken @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type MaxSlippageChanged @entity(immutable: true) {
  id: Bytes!
  maxSlippage: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type MaxTokensChanged @entity(immutable: true) {
  id: Bytes!
  maxTokens: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# Cache entities for performance optimization
type TokenCache @entity(immutable: false) {
  id: Bytes! # tokenAddress
  tokenAddress: Bytes!
  symbol: String!
  decimals: BigInt!
  updatedTimestamp: BigInt!
}

type PriceCache @entity(immutable: false) {
  id: String! # tokenAddress-timestamp
  tokenAddress: Bytes!
  priceETH: BigDecimal!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type Bundle @entity(immutable: false) {
  id: String! # always "1"
  ethPriceUSD: BigDecimal!
  lastUpdateBlock: BigInt!
  lastUpdateTimestamp: BigInt!
}

type PoolInfo @entity(immutable: false) {
  id: String! # tokenA-tokenB-fee
  tokenA: Bytes!
  tokenB: Bytes!
  fee: Int!
  poolAddress: Bytes!
  token0: Bytes!
  token1: Bytes!
  liquidity: BigInt!
  liquidityUpdatedTimestamp: BigInt!
  sqrtPriceX96: BigInt!
  slot0UpdatedTimestamp: BigInt!
}

# Fund management entities
type Info @entity(immutable: false) {
  id: Bytes!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
  owner: Bytes!
}

type Fund @entity(immutable: false) {
  id: String! # fundId
  fundId: String!
  createdAtTimestamp: BigInt!
  updatedAtTimestamp: BigInt!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  feeTokens: [Bytes!]!
  feeSymbols: [String!]!
  feeTokensAmount: [BigDecimal!]!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
}

type Investor @entity(immutable: false) {
  id: String! # fundId-investor
  createdAtTimestamp: BigInt!
  updatedAtTimestamp: BigInt!
  fundId: String!
  investor: Bytes!
  isManager: Boolean!
  share: BigInt
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}

type Setting @entity(immutable: false) {
  id: Bytes!
  managerFee: BigInt!
  maxSlippage: BigInt!
  maxTokens: BigInt!
  owner: Bytes!
}

type InvestableToken @entity(immutable: false) {
  id: Bytes! # token address
  address: Bytes!
  decimals: BigInt!
  symbol: String!
  updatedTimestamp: BigInt!
  isInvestable: Boolean!
}

# Governance Entities

type ProposalCreated @entity(immutable: true) {
  id: Bytes!
  proposalId: BigInt! # uint256
  proposer: Bytes! # address
  targets: [Bytes!]! # address[]
  values: [BigInt!]! # uint256[]
  signatures: [String!]! # string[]
  calldatas: [Bytes!]! # bytes[]
  voteStart: BigInt! # uint256
  voteEnd: BigInt! # uint256
  description: String! # string
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ProposalCanceled @entity(immutable: true) {
  id: Bytes!
  proposalId: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ProposalExecuted @entity(immutable: true) {
  id: Bytes!
  proposalId: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ProposalQueued @entity(immutable: true) {
  id: Bytes!
  proposalId: BigInt! # uint256
  eta: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type VoteCast @entity(immutable: true) {
  id: Bytes!
  voter: Bytes! # address
  proposalId: BigInt! # uint256
  support: Int! # uint8
  weight: BigInt! # uint256
  reason: String! # string
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type VoteCastWithParams @entity(immutable: true) {
  id: Bytes!
  voter: Bytes! # address
  proposalId: BigInt! # uint256
  support: Int! # uint8
  weight: BigInt! # uint256
  reason: String! # string
  params: Bytes! # bytes
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ProposalThresholdSet @entity(immutable: true) {
  id: Bytes!
  oldProposalThreshold: BigInt! # uint256
  newProposalThreshold: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type QuorumNumeratorUpdated @entity(immutable: true) {
  id: Bytes!
  oldQuorumNumerator: BigInt! # uint256
  newQuorumNumerator: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type VotingDelaySet @entity(immutable: true) {
  id: Bytes!
  oldVotingDelay: BigInt! # uint256
  newVotingDelay: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type VotingPeriodSet @entity(immutable: true) {
  id: Bytes!
  oldVotingPeriod: BigInt! # uint256
  newVotingPeriod: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type TimelockChange @entity(immutable: true) {
  id: Bytes!
  oldTimelock: Bytes! # address
  newTimelock: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# Proposal Vote Results Aggregation
type ProposalVoteResult @entity(immutable: false) {
  id: ID! # proposalId
  proposalId: BigInt! # uint256
  forVotes: BigInt! # total votes for
  againstVotes: BigInt! # total votes against
  abstainVotes: BigInt! # total abstain votes
  totalVotes: BigInt! # total votes cast
  forPercentage: BigDecimal! # percentage for (0-100)
  againstPercentage: BigDecimal! # percentage against (0-100)
  abstainPercentage: BigDecimal! # percentage abstain (0-100)
  voterCount: BigInt! # number of unique voters
  lastUpdatedBlock: BigInt! # last block when updated
  lastUpdatedTimestamp: BigInt! # last timestamp when updated
  isFinalized: Boolean! # whether voting period has ended
}

enum ProposalStatus {
  PENDING         # Created but voting hasn't started
  ACTIVE          # Voting is currently active
  QUEUED          # Proposal is queued for execution (timelock period)
  EXECUTED        # Proposal has been executed
  CANCELED        # Proposal has been canceled
}

# Comprehensive Proposal State Tracking
type Proposal @entity(immutable: false) {
  id: ID! # proposalId
  proposalId: BigInt! # uint256
  proposer: Bytes! # address
  targets: [Bytes!]! # address[]
  values: [BigInt!]! # uint256[]
  signatures: [String!]! # string[]
  calldatas: [Bytes!]! # bytes[]
  voteStart: BigInt! # uint256
  voteEnd: BigInt! # uint256
  description: String! # string
  
  # Status tracking
  status: ProposalStatus! # current status
  createdAt: BigInt! # creation timestamp
  queuedAt: BigInt # queued timestamp (null if not queued)
  executedAt: BigInt # executed timestamp (null if not executed)
  canceledAt: BigInt # canceled timestamp (null if not canceled)
  eta: BigInt # execution eta (null if not queued)
  
  # Vote aggregation (linked to ProposalVoteResult)
  voteResult: ProposalVoteResult
  
  # Block info
  createdAtBlock: BigInt!
  lastUpdatedBlock: BigInt!
}

# Individual Vote Record with aggregation helper
type Vote @entity(immutable: true) {
  id: ID! # proposalId-voter
  proposalId: BigInt! # uint256
  voter: Bytes! # address
  support: Int! # uint8 (0=against, 1=for, 2=abstain)
  weight: BigInt! # uint256
  reason: String! # string
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# Token entities for voting power tracking
type DelegateChanged @entity(immutable: true) {
  id: Bytes! # tx hash + log index
  delegator: Bytes!
  fromDelegate: Bytes!
  toDelegate: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type DelegateVotesChanged @entity(immutable: true) {
  id: Bytes! # tx hash + log index
  delegate: Bytes!
  previousBalance: BigInt!
  newBalance: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type TokenTransfer @entity(immutable: true) {
  id: Bytes! # tx hash + log index
  from: Bytes!
  to: Bytes!
  value: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# Snapshot entities for historical tracking
type InfoSnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
}

type InfoWeeklySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
}

type InfoMonthlySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
}

type FundSnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
  tokensAmountUSD: [BigDecimal!]!
}

type FundWeeklySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
  tokensAmountUSD: [BigDecimal!]!
}

type FundMonthlySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
  tokensAmountUSD: [BigDecimal!]!
}

type InvestorSnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investor: Bytes!
  share: BigInt!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}

type InvestorWeeklySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investor: Bytes!
  share: BigInt!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}

type InvestorMonthlySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investor: Bytes!
  share: BigInt!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}
